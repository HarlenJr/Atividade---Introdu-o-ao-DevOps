name: ğŸš€ Deploy Automatizado

# Triggers do workflow
on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

# ConfiguraÃ§Ãµes do workflow
env:
  PROJECT_NAME: "meu-projeto-automatizado"

jobs:
  # Job de verificaÃ§Ã£o e testes
  validate:
    name: ğŸ” ValidaÃ§Ã£o e Testes
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Clonar repositÃ³rio
      uses: actions/checkout@v4
      
    - name: ğŸ“Š InformaÃ§Ãµes do commit
      run: |
        echo "ğŸ”§ Commit SHA: ${{ github.sha }}"
        echo "ğŸ‘¤ Autor: ${{ github.actor }}"
        echo "ğŸ“ Mensagem: ${{ github.event.head_commit.message }}"
        echo "ğŸŒ¿ Branch: ${{ github.ref }}"
    
    - name: ğŸ” Verificar estrutura do projeto
      run: |
        echo "ğŸ“ Verificando estrutura de arquivos..."
        ls -la
        if [ -f "index.html" ]; then
          echo "âœ… index.html encontrado"
        else
          echo "âŒ index.html nÃ£o encontrado"
          exit 1
        fi
        
        if [ -f "style.css" ]; then
          echo "âœ… style.css encontrado"
        else
          echo "âš ï¸ style.css nÃ£o encontrado (opcional)"
        fi
    
    - name: ğŸ§ª Validar HTML
      run: |
        echo "ğŸ” Validando sintaxe HTML..."
        # VerificaÃ§Ã£o bÃ¡sica de HTML (pode ser expandida)
        if grep -q "</html>" index.html && grep -q "<!DOCTYPE" index.html; then
          echo "âœ… HTML vÃ¡lido"
        else
          echo "âŒ Estrutura HTML invÃ¡lida"
          exit 1
        fi
    
    - name: ğŸ“ EstatÃ­sticas do projeto
      run: |
        echo "ğŸ“Š EstatÃ­sticas do projeto:"
        echo "ğŸ“„ Arquivos HTML: $(find . -name "*.html" | wc -l)"
        echo "ğŸ¨ Arquivos CSS: $(find . -name "*.css" | wc -l)"
        echo "âš¡ Arquivos JS: $(find . -name "*.js" | wc -l)"
        echo "ğŸ“ Total de linhas: $(find . -name "*.html" -o -name "*.css" -o -name "*.js" | xargs wc -l | tail -1)"

  # Job principal de deploy
  deploy:
    name: ğŸš€ Deploy para ProduÃ§Ã£o
    runs-on: ubuntu-latest
    needs: validate
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: ğŸ“¥ Clonar repositÃ³rio
      uses: actions/checkout@v4
      
    - name: ğŸ”§ Setup Node.js (opcional para builds mais complexas)
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: ğŸ“¦ Preparar artefatos
      run: |
        echo "ğŸ“¦ Preparando arquivos para deploy..."
        mkdir -p dist
        cp *.html dist/ 2>/dev/null || true
        cp *.css dist/ 2>/dev/null || true
        cp *.js dist/ 2>/dev/null || true
        
        echo "ğŸ“„ Criando arquivo de informaÃ§Ãµes do build..."
        cat > dist/build-info.json << EOF
        {
          "buildTime": "$(date -u +"%Y-%m-%dT%H:%M:%SZ")",
          "commitSha": "${{ github.sha }}",
          "branch": "${{ github.ref_name }}",
          "author": "${{ github.actor }}",
          "repository": "${{ github.repository }}",
          "buildNumber": "${{ github.run_number }}"
        }
        EOF
        
        echo "ğŸ“‹ ConteÃºdo do diretÃ³rio de deploy:"
        ls -la dist/
    
    - name: ğŸ¯ Simular Deploy
      run: |
        echo "ğŸš€ Iniciando processo de deploy..."
        sleep 2
        
        echo "ğŸ“¡ Conectando com servidor de produÃ§Ã£o..."
        sleep 1
        
        echo "ğŸ“¤ Enviando arquivos..."
        sleep 2
        
        echo "ğŸ”„ Atualizando configuraÃ§Ãµes..."
        sleep 1
        
        echo "âœ… Deploy concluÃ­do com sucesso!"
        echo ""
        echo "ğŸ‰ AplicaÃ§Ã£o disponÃ­vel em: https://${{ github.actor }}.github.io/${{ github.event.repository.name }}"
    
    - name: ğŸ“Š RelatÃ³rio Final
      run: |
        echo "ğŸ“ˆ RELATÃ“RIO DE DEPLOY"
        echo "====================="
        echo "âœ… Status: Sucesso"
        echo "â° Tempo: $(date '+%d/%m/%Y Ã s %H:%M:%S')"
        echo "ğŸ”¢ Build: #${{ github.run_number }}"
        echo "ğŸ“ Commit: ${{ github.sha }}"
        echo "ğŸ‘¤ Autor: ${{ github.actor }}"
        echo "ğŸŒ¿ Branch: ${{ github.ref_name }}"
        echo "====================="
        echo ""
        echo "ğŸŠ Deploy realizado com sucesso! ğŸš€"
    
    - name: ğŸ’¾ Upload dos artefatos
      uses: actions/upload-artifact@v4
      with:
        name: build-files
        path: dist/
        retention-days: 30

  # Job de notificaÃ§Ã£o (opcional)
  notify:
    name: ğŸ“¢ NotificaÃ§Ã£o
    runs-on: ubuntu-latest
    needs: deploy
    if: always()
    
    steps:
    - name: ğŸ“¬ Status do Deploy
      run: |
        if [ "${{ needs.deploy.result }}" == "success" ]; then
          echo "âœ… Deploy realizado com sucesso!"
          echo "ğŸ‰ A aplicaÃ§Ã£o estÃ¡ no ar!"
        else
          echo "âŒ Falha no deploy"
          echo "ğŸ” Verifique os logs para mais detalhes"
        fi